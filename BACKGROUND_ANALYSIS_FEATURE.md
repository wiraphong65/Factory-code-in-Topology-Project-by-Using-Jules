# Background Analysis Feature

## ЁЯОп Feature Description
р╣Ар╕бр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М" р╣Бр╕ер╣Йр╕зр╕Ыр╕┤р╕Ф AI Panel р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Ир╕░р╕вр╕▒р╕Зр╕Др╕Зр╕Чр╕│р╕Зр╕▓р╕Щр╕нр╕вр╕╣р╣Ир╣Ар╕Ър╕╖р╣Йр╕нр╕Зр╕лр╕ер╕▒р╕Зр╣Бр╕ер╕░р╣Бр╕кр╕Фр╕З FloatingNotification

## ЁЯФД Workflow

### 1. **р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М**
```
User clicks "р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М" 
тЖТ Analysis starts
тЖТ FloatingNotification shows
тЖТ Loading state = true
```

### 2. **р╕Ыр╕┤р╕Ф Modal р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М**
```
User closes AI Panel
тЖТ Modal closes
тЖТ Analysis continues in background
тЖТ FloatingNotification remains visible
тЖТ Loading state = true (р╕вр╕▒р╕Зр╕Др╕Зр╕нр╕вр╕╣р╣И)
```

### 3. **р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ**
```
Analysis completes
тЖТ FloatingNotification hides
тЖТ Success toast shows
тЖТ Loading state = false
тЖТ Result saved to history
```

## ЁЯПЧя╕П Technical Implementation

### тЭМ **Before (Problematic)**
```javascript
const handleClose = () => {
  if (aiPanelState.loading && aiPanelState.abortController) {
    aiPanelState.abortController.abort();  // тЖР р╕вр╕Бр╣Ар╕ер╕┤р╕Бр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М
    aiPanelState.setLoading(false);
    aiPanelState.setAbortController(null);
  }
  onClose();
};
```

**Problems:**
- р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Цр╕╣р╕Бр╕вр╕Бр╣Ар╕ер╕┤р╕Бр╣Ар╕бр╕╖р╣Ир╕нр╕Ыр╕┤р╕Ф modal
- р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Хр╣Йр╕нр╕Зр╕гр╕нр╣Гр╕лр╣Йр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Ар╕кр╕гр╣Зр╕Ир╕Бр╣Ир╕нр╕Щр╕Ыр╕┤р╕Ф modal
- UX р╣Др╕бр╣Ир╕Фр╕╡

### тЬЕ **After (Background Processing)**
```javascript
const handleClose = () => {
  // р╣Др╕бр╣Ир╕вр╕Бр╣Ар╕ер╕┤р╕Бр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Ар╕бр╕╖р╣Ир╕нр╕Ыр╕┤р╕Ф modal
  // р╣Гр╕лр╣Йр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Чр╕│р╕Зр╕▓р╕Щр╕Хр╣Ир╕нр╣Ар╕Ър╕╖р╣Йр╕нр╕Зр╕лр╕ер╕▒р╕З
  onClose();
};
```

**Benefits:**
- р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Чр╕│р╕Зр╕▓р╕Щр╕Хр╣Ир╕нр╣Ар╕Ър╕╖р╣Йр╕нр╕Зр╕лр╕ер╕▒р╕З
- р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Ыр╕┤р╕Ф modal р╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡
- FloatingNotification р╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ

## ЁЯОи User Experience Flow

### ЁЯУ▒ **Scenario 1: р╕Ыр╕┤р╕Ф Modal р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М**
1. User р╣Ар╕Ыр╕┤р╕Ф AI Panel
2. User р╕Бр╕Ф "р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М"
3. FloatingNotification р╕Ыр╕гр╕▓р╕Бр╕П
4. User р╕Ыр╕┤р╕Ф AI Panel (р╕Др╕ер╕┤р╕Бр╕Вр╣Йр╕▓р╕Зр╕Щр╕нр╕Бр╕лр╕гр╕╖р╕нр╕Бр╕Ф X)
5. Modal р╕Ыр╕┤р╕Ф р╣Бр╕Хр╣И FloatingNotification р╕вр╕▒р╕Зр╣Бр╕кр╕Фр╕Зр╕нр╕вр╕╣р╣И
6. р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Чр╕│р╕Зр╕▓р╕Щр╕Хр╣Ир╕нр╣Ар╕Ър╕╖р╣Йр╕нр╕Зр╕лр╕ер╕▒р╕З
7. р╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕кр╕гр╣Зр╕И: FloatingNotification р╕лр╕▓р╕вр╣Др╕Ы + р╣Бр╕кр╕Фр╕З success toast

### ЁЯЦея╕П **Scenario 2: р╕гр╕нр╣Гр╕лр╣Йр╣Ар╕кр╕гр╣Зр╕Ир╣Гр╕Щ Modal**
1. User р╣Ар╕Ыр╕┤р╕Ф AI Panel
2. User р╕Бр╕Ф "р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М"
3. User р╕гр╕нр╕Фр╕╣р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Гр╕Щ Modal
4. р╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕кр╕гр╣Зр╕И: р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Бр╕кр╕Фр╕Зр╣Гр╕Щ Modal
5. User р╕Фр╕╣р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Бр╕ер╕░р╕Ыр╕┤р╕Ф Modal

## ЁЯФз Component Integration

### ЁЯПа **AI Panel (index.tsx)**
- **handleClose:** р╣Др╕бр╣Ир╕вр╕Бр╣Ар╕ер╕┤р╕Бр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М
- **FloatingNotification:** р╣Бр╕кр╕Фр╕Зр╣Ар╕бр╕╖р╣Ир╕н modal р╕Ыр╕┤р╕Фр╣Бр╕ер╣Йр╕з

### ЁЯОг **useAIPanel Hook**
- **handleAnalyze:** р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М + р╣Бр╕кр╕Фр╕З FloatingNotification
- **Loading State:** р╕Др╕Зр╕нр╕вр╕╣р╣Ир╕Ир╕Щр╕Бр╕зр╣Ир╕▓р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Ир╕░р╣Ар╕кр╕гр╣Зр╕И
- **AbortController:** р╕вр╕▒р╕Зр╕Др╕Зр╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕Ър╕╖р╣Йр╕нр╕Зр╕лр╕ер╕▒р╕З

### ЁЯФФ **FloatingNotification**
- **Show Condition:** `aiPanelState.showFloatingNotification`
- **Position:** р╕ер╕▓р╕Бр╣Др╕Фр╣Й р╣Др╕бр╣Ир╕Ър╕▒р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ
- **Cancel Button:** р╕вр╕Бр╣Ар╕ер╕┤р╕Бр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Др╕Фр╣Й

## ЁЯОп Benefits

### тЬЕ **Better UX**
- **Non-blocking:** р╣Др╕бр╣Ир╕Ър╕▒р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕нр╕╖р╣Ир╕Щ
- **Flexible:** р╕Ыр╕┤р╕Ф modal р╣Др╕Фр╣Йр╕Хр╕ер╕нр╕Фр╣Ар╕зр╕ер╕▓
- **Informative:** р╕гр╕╣р╣Йр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕кр╕бр╕н

### тЬЕ **Better Workflow**
- **Multitasking:** р╕Чр╕│р╕Зр╕▓р╕Щр╕нр╕╖р╣Ир╕Щр╣Др╕Фр╣Йр╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕гр╕н
- **No Interruption:** р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Вр╕▒р╕Фр╕Ир╕▒р╕Зр╕лр╕зр╕░
- **Progress Tracking:** р╕Хр╕┤р╕Фр╕Хр╕▓р╕бр╕Др╕зр╕▓р╕бр╕Др╕╖р╕Ър╕лр╕Щр╣Йр╕▓р╣Др╕Фр╣Й

### тЬЕ **Better Performance**
- **Background Processing:** р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕Ыр╕┤р╕Ф modal р╕Др╣Йр╕▓р╕Зр╣Др╕зр╣Й
- **Resource Efficient:** р╣Гр╕Кр╣Йр╕Чр╕гр╕▒р╕Юр╕вр╕▓р╕Бр╕гр╣Др╕Фр╣Йр╕Фр╕╡
- **User Freedom:** р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕бр╕╡р╕нр╕┤р╕кр╕гр╕░р╕бр╕▓р╕Бр╕Вр╕╢р╣Йр╕Щ

## ЁЯФД State Management

### Analysis States:
```
IDLE тЖТ LOADING тЖТ COMPLETED/ERROR
  тЖС                    тЖУ
  тФФтФАтФА (can close) тФАтФАтФАтФАтФАтФШ
```

### Modal States:
```
CLOSED тЯ╖ OPEN
(Analysis can run in both states)
```

### FloatingNotification States:
```
HIDDEN тЖТ VISIBLE тЖТ HIDDEN
(Shows when analysis is running)
```

## тЬЕ Result

**Background Analysis Feature р╕Чр╕│р╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╣Бр╕ер╣Йр╕з:**

- тЬЕ **р╕Ыр╕┤р╕Ф Modal р╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡** - р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕гр╕нр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Ар╕кр╕гр╣Зр╕И
- тЬЕ **р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Чр╕│р╕Зр╕▓р╕Щр╕Хр╣Ир╕н** - р╣Ар╕Ър╕╖р╣Йр╕нр╕Зр╕лр╕ер╕▒р╕Зр╣Др╕бр╣Ир╕лр╕вр╕╕р╕Ф
- тЬЕ **FloatingNotification р╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░** - р╕гр╕╣р╣Йр╕зр╣Ир╕▓р╕Бр╕│р╕ер╕▒р╕Зр╕Чр╕│р╕Зр╕▓р╕Щ
- тЬЕ **р╕вр╕Бр╣Ар╕ер╕┤р╕Бр╣Др╕Фр╣Й** - р╕Бр╕Фр╕Ыр╕╕р╣Ир╕бр╕вр╕Бр╣Ар╕ер╕┤р╕Бр╣Гр╕Щ FloatingNotification
- тЬЕ **UX р╕Чр╕╡р╣Ир╕Фр╕╡** - р╣Др╕бр╣Ир╕Ър╕▒р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕нр╕╖р╣Ир╕Щ

**Background Analysis AI Panel р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з!** ЁЯЪАтЬи